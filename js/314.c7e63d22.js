"use strict";(self["webpackChunkworks"]=self["webpackChunkworks"]||[]).push([[314],{6450:function(t,e,a){a.d(e,{Z:function(){return D}});var s=a(3396),l=a(7139);const o={class:"modal fade",id:"delModal",ref:"modal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},i={class:"modal-dialog modal-dialog-centered",role:"document"},r={class:"modal-content"},d={class:"modal-header bg-danger text-white"},n={key:0,class:"modal-title",id:"exampleModalLabel"},c={key:1,class:"modal-title",id:"delProduct"},u={key:2,class:"modal-title",id:"delOrder"},p=(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),m={key:0,class:"modal-body"},h={class:"text-danger"},f={key:1,class:"modal-body"},g={class:"text-danger"},b={key:2,class:"modal-body"},_={class:"text-danger"},v={class:"modal-footer"},y=(0,s._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function w(t,e,a,w,k,C){return(0,s.wg)(),(0,s.iD)("div",o,[(0,s._)("div",i,[(0,s._)("div",r,[(0,s._)("div",d,[a.item.title?((0,s.wg)(),(0,s.iD)("h5",n,"刪除 "+(0,l.zw)(a.item.title),1)):a.item.product?((0,s.wg)(),(0,s.iD)("h5",c,"刪除 "+(0,l.zw)(a.item.product.title),1)):a.item.id?((0,s.wg)(),(0,s.iD)("h5",u,"刪除 "+(0,l.zw)(a.item.id),1)):(0,s.kq)("",!0),p]),a.item.title?((0,s.wg)(),(0,s.iD)("div",m,[(0,s.Uk)(" 是否刪除 "),(0,s._)("strong",h,(0,l.zw)(a.item.title),1),(0,s.Uk)(" (刪除後將無法恢復)。 ")])):a.item.product?((0,s.wg)(),(0,s.iD)("div",f,[(0,s.Uk)(" 是否刪除 "),(0,s._)("strong",g,(0,l.zw)(a.item.product.title),1),(0,s.Uk)(" (刪除後將無法恢復)。 ")])):a.item.id?((0,s.wg)(),(0,s.iD)("div",b,[(0,s.Uk)(" 是否刪除 "),(0,s._)("strong",_,(0,l.zw)(a.item.id),1),(0,s.Uk)(" (刪除後將無法恢復)。 ")])):(0,s.kq)("",!0),(0,s._)("div",v,[y,(0,s._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e[0]||(e[0]=e=>t.$emit("del-item"))},"確定刪除")])])])],512)}var k=a(1339),C={props:{item:{}},data(){return{modal:{}}},mixins:[k.Z]},$=a(89);const x=(0,$.Z)(C,[["render",w]]);var D=x},3397:function(t,e,a){a.d(e,{Z:function(){return u}});var s=a(3396);const l={class:"stepper-wrapper list-unstyled d-flex justify-content-around mb-4",ref:"stepper"},o=(0,s.uE)('<li><span class="step-content"><i class="bi bi-cart fs-4"></i></span><span>購物車</span></li><li><span class="step-content"><i class="bi bi-credit-card fs-4"></i></span><span>付款</span></li><li><span class="step-content"><i class="bi bi-check-circle fs-4"></i></span><span>完成</span></li>',3),i=[o];function r(t,e,a,o,r,d){return(0,s.wg)(),(0,s.iD)("ul",l,i,512)}var d={methods:{addStepperStatus(t){this.$refs.stepper.childNodes.forEach(((e,a)=>{t===a+1?e.classList.add("active"):e.classList.remove("active")}))}}},n=a(89);const c=(0,n.Z)(d,[["render",r]]);var u=c},6314:function(t,e,a){a.r(e),a.d(e,{default:function(){return ct}});var s=a(3396),l=a(9242),o=a(7139);const i={key:0},r={class:"d-none d-md-block"},d={class:"table"},n=(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",{scope:"col"},"品名"),(0,s._)("th",{scope:"col",width:"110px"},"單價"),(0,s._)("th",{scope:"col",width:"110px"},"數量"),(0,s._)("th",{scope:"col",width:"110px"},"小計"),(0,s._)("th",{scope:"col",width:"110px"})])],-1),c=["onClick"],u=["src","alt"],p=["onUpdate:modelValue","onChange","disabled"],m=["value"],h={key:0},f={key:1},g={class:"text-secondary"},b={class:"text-end"},_=["onClick"],v=(0,s._)("i",{class:"bi bi-trash fs-5"},null,-1),y=[v],w={class:"d-md-none"},k={class:"col-4"},C=["onClick"],$=["src","alt"],x={class:"col"},D={class:"mb-2"},M=["onUpdate:modelValue","onChange","disabled"],z=["value"],U={key:0,class:"mb-0 mt-2"},V={key:1,class:"mb-0 mt-2"},L={class:"text-secondary pe-1"},S={class:"col-2"},q=["onClick"],W=(0,s._)("i",{class:"bi bi-trash fs-4"},null,-1),N=[W],T={class:"col-md-4 offset-md-8"},I={class:"d-flex justify-content-between my-2"},P=(0,s._)("span",null,"總計:",-1),Z={key:0,class:"d-flex justify-content-between my-2 text-danger"},j=(0,s._)("span",null,"折扣價:",-1),H={class:"input-group input-group-sm mb-3"},Y={key:1},E=(0,s._)("h4",{class:"text-center"},"購物車尚無商品，快去選購吧~",-1),K=[E],O={key:2,class:"row justify-content-center my-5"},B=(0,s._)("h5",{class:"text-center text-secondary fw-bold"},"寄送資料",-1),A={class:"mb-3"},F=(0,s._)("label",{for:"name",class:"form-label"},"收件人姓名*",-1),G={class:"mb-3"},J=(0,s._)("label",{for:"tel",class:"form-label"},"收件人電話*",-1),Q={class:"mb-3"},R=(0,s._)("label",{for:"address",class:"form-label"},"收件人地址*",-1),X={class:"mb-3"},tt=(0,s._)("label",{for:"email",class:"form-label"},"Email*",-1),et={class:"mb-3"},at=(0,s._)("label",{for:"message",class:"form-label"},"備註",-1),st=(0,s._)("div",{class:"text-end"},[(0,s._)("button",{type:"submit",class:"btn btn-outline-warning"},"送出訂單")],-1);function lt(t,e,a,v,W,E){const lt=(0,s.up)("LoadingOverlay"),ot=(0,s.up)("ProgressBar"),it=(0,s.up)("v-field"),rt=(0,s.up)("error-message"),dt=(0,s.up)("v-form"),nt=(0,s.up)("DelModal");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(lt,{active:W.isLoading},null,8,["active"]),(0,s.Wm)(ot,{ref:"stepperComponent"},null,512),0!==W.cart.total?((0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("div",r,[(0,s._)("table",d,[n,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(W.cart.carts,(e=>((0,s.wg)(),(0,s.iD)("tr",{key:e.id,class:"align-middle"},[(0,s._)("td",null,[(0,s._)("a",{href:"#",onClick:(0,l.iM)((t=>E.getProduct(e.product.id)),["prevent"])},[(0,s._)("img",{src:e.product.imageUrl,alt:e.product.title,class:"object-fit-cover",width:"100",height:"80"},null,8,u)],8,c),(0,s.Uk)(" "+(0,o.zw)(e.product.title),1)]),(0,s._)("td",null,"NT$ "+(0,o.zw)(t.$filters.currency(e.product.price)),1),(0,s._)("td",null,[(0,s.wy)((0,s._)("select",{class:"form-select form-select-sm","onUpdate:modelValue":t=>e.qty=t,onChange:t=>E.updateCart(e),disabled:W.status.loadingItem===e.id},[((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)(10,(t=>(0,s._)("option",{key:t,value:t},(0,o.zw)(t),9,m))),64))],40,p),[[l.bM,e.qty,void 0,{number:!0}]])]),(0,s._)("td",null,[e.total===e.final_total?((0,s.wg)(),(0,s.iD)("div",h,"NT$ "+(0,o.zw)(t.$filters.currency(e.total)),1)):((0,s.wg)(),(0,s.iD)("div",f,[(0,s._)("del",g,"NT$ "+(0,o.zw)(t.$filters.currency(e.total)),1),(0,s._)("div",null,"NT$ "+(0,o.zw)(t.$filters.currency(e.final_total)),1)]))]),(0,s._)("td",b,[(0,s._)("a",{href:"#",class:"link-secondary",onClick:(0,l.iM)((t=>E.openDelCartModal(e)),["prevent"])},y,8,_)])])))),128))])])]),(0,s._)("div",w,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(W.cart.carts,(e=>((0,s.wg)(),(0,s.iD)("div",{class:"row border-top border-bottom py-2 align-items-center",key:e.id},[(0,s._)("div",k,[(0,s._)("a",{href:"#",onClick:(0,l.iM)((t=>E.getProduct(e.product.id)),["prevent"])},[(0,s._)("img",{src:e.product.imageUrl,alt:e.product.title,class:"object-fit-cover w-100",height:"100"},null,8,$)],8,C)]),(0,s._)("div",x,[(0,s._)("h6",null,(0,o.zw)(e.product.title),1),(0,s._)("p",D,"單價: NT$ "+(0,o.zw)(t.$filters.currency(e.product.price)),1),(0,s.wy)((0,s._)("select",{name:"",id:"",class:"form-select form-select-sm w-50","onUpdate:modelValue":t=>e.qty=t,onChange:t=>E.updateCart(e),disabled:W.status.loadingItem===e.id},[((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)(10,(t=>(0,s._)("option",{key:t,value:t},(0,o.zw)(t),9,z))),64))],40,M),[[l.bM,e.qty,void 0,{number:!0}]]),e.total===e.final_total?((0,s.wg)(),(0,s.iD)("p",U,"小計: NT$ "+(0,o.zw)(t.$filters.currency(e.total)),1)):((0,s.wg)(),(0,s.iD)("p",V,[(0,s._)("del",L,"NT$ "+(0,o.zw)(t.$filters.currency(e.total)),1),(0,s._)("span",null,"NT$ "+(0,o.zw)(t.$filters.currency(e.final_total)),1)]))]),(0,s._)("div",S,[(0,s._)("a",{href:"#",class:"link-secondary",onClick:(0,l.iM)((t=>E.openDelCartModal(e)),["prevent"])},N,8,q)])])))),128))]),(0,s._)("div",T,[(0,s._)("div",I,[P,(0,s._)("span",null,"NT$ "+(0,o.zw)(t.$filters.currency(W.cart.total)),1)]),W.cart.total!==W.cart.final_total?((0,s.wg)(),(0,s.iD)("div",Z,[j,(0,s._)("span",null,"NT$ "+(0,o.zw)(t.$filters.currency(W.cart.final_total)),1)])):(0,s.kq)("",!0),(0,s._)("div",H,[(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",placeholder:"請輸入折扣碼","onUpdate:modelValue":e[0]||(e[0]=t=>W.coupon_code=t)},null,512),[[l.nr,W.coupon_code]]),(0,s._)("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[1]||(e[1]=(...t)=>E.addCouponCode&&E.addCouponCode(...t))},"套用")])])])):((0,s.wg)(),(0,s.iD)("div",Y,K)),0!==W.cart.total?((0,s.wg)(),(0,s.iD)("div",O,[(0,s.Wm)(dt,{class:"col-md-6",onSubmit:(0,l.iM)(E.createOrder,["prevent"])},{default:(0,s.w5)((({errors:t})=>[B,(0,s._)("div",A,[F,(0,s.Wm)(it,{type:"text",name:"姓名",class:(0,o.C_)(["form-control",{"is-invalid":t["姓名"]}]),id:"name",placeholder:"請輸入姓名",rules:"required",modelValue:W.form.user.name,"onUpdate:modelValue":e[2]||(e[2]=t=>W.form.user.name=t)},null,8,["class","modelValue"]),(0,s.Wm)(rt,{name:"姓名",class:"invalid-feedback"})]),(0,s._)("div",G,[J,(0,s.Wm)(it,{type:"tel",name:"tel",class:(0,o.C_)(["form-control",{"is-invalid":t["tel"]}]),id:"tel",placeholder:"請輸入電話",rules:E.isPhone,modelValue:W.form.user.tel,"onUpdate:modelValue":e[3]||(e[3]=t=>W.form.user.tel=t)},null,8,["rules","class","modelValue"]),(0,s.Wm)(rt,{name:"tel",class:"invalid-feedback"})]),(0,s._)("div",Q,[R,(0,s.Wm)(it,{type:"text",name:"地址",class:(0,o.C_)(["form-control",{"is-invalid":t["地址"]}]),id:"address",placeholder:"請輸入地址",rules:"required",modelValue:W.form.user.address,"onUpdate:modelValue":e[4]||(e[4]=t=>W.form.user.address=t)},null,8,["class","modelValue"]),(0,s.Wm)(rt,{name:"地址",class:"invalid-feedback"})]),(0,s._)("div",X,[tt,(0,s.Wm)(it,{type:"email",name:"email",class:(0,o.C_)(["form-control",{"is-invalid":t["email"]}]),id:"email",placeholder:"請輸入Email",rules:"email|required",modelValue:W.form.user.email,"onUpdate:modelValue":e[5]||(e[5]=t=>W.form.user.email=t)},null,8,["class","modelValue"]),(0,s.Wm)(rt,{name:"email",class:"invalid-feedback"})]),(0,s._)("div",et,[at,(0,s.wy)((0,s._)("textarea",{class:"form-control",id:"message",rows:"3","onUpdate:modelValue":e[6]||(e[6]=t=>W.form.message=t)},null,512),[[l.nr,W.form.message]])]),st])),_:1},8,["onSubmit"])])):(0,s.kq)("",!0),(0,s.Wm)(nt,{ref:"delModal",item:W.tempCart,onDelItem:E.delCartItem},null,8,["item","onDelItem"])],64)}a(7658);var ot=a(6450),it=a(3397),rt={data(){return{cart:{},tempCart:{},coupon_code:"",status:{loadingItem:""},isLoading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},inject:["$httpMessageState","reload"],components:{DelModal:ot.Z,ProgressBar:it.Z},methods:{getCart(){const t="https://vue3-course-api.hexschool.io/api/shoppingmall-api/cart";this.isLoading=!0,this.$http.get(t).then((t=>{this.cart=t.data.data,0!==this.cart.total&&this.cart.carts[0].coupon&&!this.cart.carts[this.cart.carts.length-1].coupon&&(this.coupon_code=this.cart.carts[0].coupon.code,this.addCouponCode()),this.isLoading=!1})).catch((t=>{this.$httpMessageState(t,"連線"),this.isLoading=!1}))},getProduct(t){this.$router.push(`/user/product/${t}`)},updateCart(t){const e=`https://vue3-course-api.hexschool.io/api/shoppingmall-api/cart/${t.id}`;this.status.loadingItem=t.id,this.isLoading=!0;const a={product_id:t.product_id,qty:t.qty};this.$http.put(e,{data:a}).then((t=>{this.status.loadingItem="",this.isLoading=!1,this.getCart()})).catch((t=>{this.$httpMessageState(t,"連線"),this.isLoading=!1}))},addCouponCode(){const t="https://vue3-course-api.hexschool.io/api/shoppingmall-api/coupon";this.isLoading=!0,this.$http.post(t,{data:{code:this.coupon_code.trim()}}).then((t=>{this.$httpMessageState(t,"套用優惠券"),this.isLoading=!1,this.getCart()})).catch((t=>{this.$httpMessageState(t,"連線"),this.isLoading=!1}))},openDelCartModal(t){this.tempCart={...t};const e=this.$refs.delModal;e.showModal()},delCartItem(){const t=`https://vue3-course-api.hexschool.io/api/shoppingmall-api/cart/${this.tempCart.id}`;this.$http.delete(t).then((t=>{const e=this.$refs.delModal;e.hideModal(),this.getCart(),this.reload(),setTimeout((()=>{this.$httpMessageState(t,"刪除品項")}))})).catch((t=>{this.$httpMessageState(t,"連線")}))},createOrder(){const t="https://vue3-course-api.hexschool.io/api/shoppingmall-api/order";this.$http.post(t,{data:this.form}).then((t=>{t.data.success&&(this.$router.push(`/user/checkout/${t.data.orderId}`),this.reload())})).catch((t=>{this.$httpMessageState(t,"連線")}))},isPhone(t){const e=/^(09)[0-9]{8}$/;return!!e.test(t)||"請輸入正確的電話號碼"}},created(){this.getCart()},mounted(){this.$refs.stepperComponent.addStepperStatus(1)}},dt=a(89);const nt=(0,dt.Z)(rt,[["render",lt]]);var ct=nt}}]);
//# sourceMappingURL=314.c7e63d22.js.map